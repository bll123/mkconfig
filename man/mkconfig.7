.\"
.\" $Id$
.\" $Revision$
.\"
.\" mkconfig.1
.\"
.\" Copyright 2010 Brad Lanam  Walnut Creek CA USA
.\"
.\" bll6969di_at_gmail.com
.\"
.TH mkconfig 1 "3 Mar 2010"
.SH Name
mkconfig \- build configuration utilities
.SH Synopsis
.\" mkconfig.sh [-C] [-c <cache-file>] [-v <vars-file>] [-l <log-file>]
.\"    [-t <tmp-dir>] [-r <reqlib-file>] config-file
.\" environment.sh [-C] [-l <log-file>] config-file
.B mkconfig.sh
[\fB\-C\fP]
[\fB\-c\fP <cache\-file>]
[\fB\-v\fP <vars\-file>]
[\fB\-l\fP <log\-file>]
.br
[\fB\-t\fP <tmp\-dir>]
[\fB\-r\fP <reqlib-file>]
config\-file
.PP
cache\-file defaults to 'mkconfig.cache'.
.br
vars\-file defaults to 'mkconfig.vars'.
.br
log\-file defaults to 'mkconfig.log'.
.br
tmp\-dir defaults to '_tmp_mkconfig'.
This directory must not exist before running \fImkconfig.sh\fP,
as it will be removed in its entirety.
.br
reqlib\-file defaults to 'reqlibs.txt'.
.PP
.B environment.sh
[\fB\-C\fP]
[\fB\-l\fP <log\-file>]
config\-file
.PP
log\-file defaults to 'mkconfig_env.log'.
.SH Description
\fImkconfig.sh\fP
is a build configuration utility originally modeled after iffe.
It is written in portable shell script and
designed to be extensible for any configuration use.
.PP
\fImkconfig.sh\fP
is intended to generate a configuration file that can be included
in your source code in order to set macros or include code that
modifies the compilation behaviour of your program on different
systems.
.PP
\fIenvironment.sh\fP
is intended to check the system environment and create a file
that can set the environment to control the build process.  The
various units output environment variable settings to a file that
can be executed by a shell script to set the environment.
.SH environment.sh Basic Configuration Commands
.TP
\fBoutput\fP file\-name (required)
.br
Specify the name of the output file.
.TP
\fBrununit\fP unit\-name
.br
Execute an environment unit.
.SH environment.sh Units
.PP
.TP
.B systype
.br
The systype environment unit sets the following environment variables:
_MKCONFIG_SYSTYPE, _MKCONFIG_SYSREV, _MKCONFIG_SYSARCH.  These generally
correspond to the output of uname -s, uname -r and uname -a respectively.
On AIX, the oslevel command is used to attempt to resolv the revision
of the operating system.  On MacOSX, the revision is used unchanged and
does not correspond to the marketing level.
.B cflags
.br
The cflags environment unit sets the following environment variables:
CC, CFLAGS, CINCLUDES, LDFLAGS, LIBS, _MKCONFIG_USING_GCC.  CC will default
to 'cc' unless already set.  CFLAGS, CINCLUDES, LDFLAGS and LIBS will
be according to the 'getconf'
program and with flags appropriate to the system type and compiler.
.TP
.B object_extension
.br
The object_extension environment unit set the following environment
variables: OBJ_EXT, EXE_EXT.  These two variables are set to the
object file extension (.o, .obj) and executable file extension (none or
.exe) per the operating system and compiler.
.TP
.B msgfmt
.br
\fImsgfmt\fP sets the XMSGFMT environment variable to the path of the
msgfmt command, if any.
.SH Basic Configuration Commands (mkconfig.sh)
.PP
.TP
\fBoutput\fP file\-name (required)
.br
Specify the name of the output file.
.TP
\fBloadunit\fP unit\-name
.br
Include a mkconfig unit for testing.
Units may include specific check routines that may be performed.
.TP
\fBstandard\fP
.br
Perform any standard checks for the language unit that was loaded.
.TP
command  name\-of\-command
.br
Check if command exists in the path.
e.g.: command sed
.TP
.B include endinclude
.br
Include all of the code between these two tags
in the configuration file.  Backslashes must
be escaped with a backslash.
.SH mkconfig.sh Units
.PP
.TP
.B lang-c
.br
The lang-c unit creates an include file for C programs.
.TP
\fBhdr\fP name\-of\-header [required\-headers]
.br
Check for a header.
The standard include path as set in CFLAGS is used.
If \fIrequired\-headers\fP is specified, those headers
are included in the compilation test before attempting
the compilation test.
e.g. hdr storage/volumes.h gui/window.h
.TP
\fBsys\fP name\-of\-sys\-header [required\-headers]
.br
Like \fIhdr\fP, but looks in the sys/ directory.
e.g. sys types.h
.TP
\fBconst\fP constant\-name [required\-headers]
.br
Check to see that a constant exists.
If \fIrequired\-headers\fP is specified, those headers
are included in the compilation test before attempting
the compilation test.
e.g. const O_RDONLY
.TP
\fBkey\fP keyword
.br
Check to see if a C-language keyword is reserved.
e.g. key volatile
.TP
\fBnpt\fP function [library\-requirement]
.br
Check to see if if \fIfunction\fP needs to have a prototype declared.
The optional \fIlibrary\-requirement\fP should be written
as: _lib_<funcname>
If \fIlibrary\-requirement\fP does not exist, _npt_<function>
will set set to false in the output file.
e.g. npt getopt; npt statfs _lib_statfs
.TP
\fBtyp\fP type\-name
.br
Check to see if type\-name exists.
e.g. typ size_t
.TP
\fBlib\fP function [libs]
.br
Check to see if library function \fIfunction\fP exists.
If the optional \fIlibs\fP are specified,
the test will try first without the libraries, then with
the first library, then the first and next, etc.
e.g. lib gettext -lintl -liconv
will first test gettext, then gettext -lintl, then gettext -lintl -liconv.
.br
Any libraries that are found to be needed for compilation will be
output to the 'reqlibs.txt' file.
.TP
\fBclass\fP class [libs]
.br
Check to see if class \fIclass\fP exists.
If the optional \fIlibs\fP are specified,
the test will try first without the libraries, then with
the first library, then the first and next, etc.
e.g.: class os::Volumes
.br
Any libraries that are found to be needed for compilation will be
output to the 'reqlibs.txt' file.
.TP
\fBdcl\fP {int|ptr} variable
.br
Check to see if the variable is declared.
If \fIint\fP is specified, the variable is a numeric type.
If \fIptr\fP is specified, the variable is a pointer type.
e.g. dcl int errno; dcl ptr optarg
.TP
\fBmember\fP struct member
.br
Check to see if \fImember\fP is a member of \fIstruct\fP.
e.g.: member statfs f_bsize
.TP
.B statfs\-args
.br
.TP
.B setmntent\-args
.br
.TP
.B include\-malloc
.br
.TP
.B include\-time
.br
.TP
.B include\-string
.br
The lang-c unit creates an include file for C programs.
.SH Creating a New Language Module
.SH See Also
iffe(1) autoconf(1) dist(7)
.SH Bugs
Send bug reports to: bll6969di_at_gmail.com
.SH Website
\fImkconfig\fP is currently packaged in conjunction with \fIdi\fP
.PP
http://www.gentoo.com/di/
.SH Author
This program is Copyright 2010 by Brad Lanam.
.PP
Brad Lanam, Walnut Creek, CA (bll6969di_at_gmail.com)
